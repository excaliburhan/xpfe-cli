#!/usr/bin/env node

var path = require('path')
var inquirer = require('inquirer')
var chalk = require('chalk')
var file = require('../lib/file')
var tplJSON = require(file.filePath())

function updateTpl(obj, overwrite) {
  var act = overwrite ? 'updated.' : 'added.'
  var str = 'Template `'+ obj.name +'` ' + act
  tplJSON[obj.name] = obj.url
  file.updateFile(JSON.stringify(tplJSON), str)
}

console.log()
process.on('exit', function () {
  console.log()
})

inquirer.prompt([
  {
    name: 'name',
    type: 'input',
    message: 'What is the template name?'
  },
  {
    name: 'url',
    type: 'input',
    message: 'What is the template git url?'
  }
]).then(function (ans) {
  if (!ans.name || !ans.url) {
    console.log()
    console.log(chalk.red('Please input template name or git url!'))
    process.exit()
  }
  if (tplJSON[ans.name]) {
    inquirer.prompt([
      {
        name: 'overwrite',
        type: 'confirm',
        message: 'Template `' + ans.name + '` already exists, overwrite?'
      }
    ]).then(function (ans2) {
      if (ans2.overwrite) updateTpl(ans, true)
    })
  } else {
    updateTpl(ans)
  }
})

